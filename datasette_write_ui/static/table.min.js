function re(e){let n=document.createElement("template");return n.innerHTML=e,document.importNode(n.content,!0)}function oe(e){let n=document.createElementNS("http://www.w3.org/2000/svg","g");return n.innerHTML=e,n}var m=Object.assign(W(re,e=>{if(e.firstChild===null)return null;if(e.firstChild===e.lastChild)return e.removeChild(e.firstChild);let n=document.createElement("span");return n.appendChild(e),n}),{fragment:W(re,e=>e)}),st=Object.assign(W(oe,e=>e.firstChild===null?null:e.firstChild===e.lastChild?e.removeChild(e.firstChild):e),{fragment:W(oe,e=>{let n=document.createDocumentFragment();for(;e.firstChild;)n.appendChild(e.firstChild);return n})}),Be=9,He=10,Ie=12,Fe=13,Pe=32,Ge=65,qe=90,je=97,Xe=122,I=60,h=62,g=47,_=45,Q=33,V=61,ae=34,le=39,We=63,T=1,ce=2,ue=3,Y=4,F=5,k=6,J=7,P=8,G=9,Z=10,z=11,q=12,K=13,x=14,de=15,fe=16,w=17,pe=18,Ee=19,Te=20,he=21,ee=22,U=23,me=24,ye=25,b=26,_e=27,be=28,Se=29,Qe=128,we=1,Ve=8,Ye=1,Ne="http://www.w3.org/2000/svg",v="http://www.w3.org/1999/xlink",Ae="http://www.w3.org/XML/1998/namespace",ge="http://www.w3.org/2000/xmlns/",ve=new Map(["attributeName","attributeType","baseFrequency","baseProfile","calcMode","clipPathUnits","diffuseConstant","edgeMode","filterUnits","glyphRef","gradientTransform","gradientUnits","kernelMatrix","kernelUnitLength","keyPoints","keySplines","keyTimes","lengthAdjust","limitingConeAngle","markerHeight","markerUnits","markerWidth","maskContentUnits","maskUnits","numOctaves","pathLength","patternContentUnits","patternTransform","patternUnits","pointsAtX","pointsAtY","pointsAtZ","preserveAlpha","preserveAspectRatio","primitiveUnits","refX","refY","repeatCount","repeatDur","requiredExtensions","requiredFeatures","specularConstant","specularExponent","spreadMethod","startOffset","stdDeviation","stitchTiles","surfaceScale","systemLanguage","tableValues","targetX","targetY","textLength","viewBox","viewTarget","xChannelSelector","yChannelSelector","zoomAndPan"].map(e=>[e.toLowerCase(),e])),X=new Map([["xlink:actuate",v],["xlink:arcrole",v],["xlink:href",v],["xlink:role",v],["xlink:show",v],["xlink:title",v],["xlink:type",v],["xml:lang",Ae],["xml:space",Ae],["xmlns",ge],["xmlns:xlink",ge]]);function W(e,n){return function({raw:r}){let t=T,l="",f,u,p,c,E=0;for(let o=0,S=arguments.length;o<S;++o){let a=r[o];if(o>0){let i=arguments[o];switch(t){case b:{if(i!=null){let d=`${i}`;if(Re(u))l+=d.replace(/[<]/g,M);else{if(new RegExp(`</${u}[\\s>/]`,"i").test(l.slice(-u.length-2)+d))throw new Error("unsafe raw text");l+=d}}break}case T:{i==null||(i instanceof Node||typeof i!="string"&&i[Symbol.iterator]||/(?:^|>)$/.test(r[o-1])&&/^(?:<|$)/.test(a)?(l+="<!--::"+o+"-->",E|=Qe):l+=`${i}`.replace(/[<&]/g,M));break}case G:{t=q;let d;if(/^[\s>]/.test(a)){if(i==null||i===!1){l=l.slice(0,p-r[o-1].length);break}if(i===!0||(d=`${i}`)==""){l+="''";break}if(r[o-1].slice(p,c)==="style"&&te(i)||typeof i=="function"){l+="::"+o,E|=we;break}}if(d===void 0&&(d=`${i}`),d==="")throw new Error("unsafe unquoted empty string");l+=d.replace(/^['"]|[\s>&]/g,M);break}case q:{l+=`${i}`.replace(/[\s>&]/g,M);break}case z:{l+=`${i}`.replace(/['&]/g,M);break}case Z:{l+=`${i}`.replace(/["&]/g,M);break}case k:{if(te(i)){l+="::"+o+"=''",E|=we;break}throw new Error("invalid binding")}case w:break;default:throw new Error("invalid binding")}}for(let i=0,d=a.length;i<d;++i){let s=a.charCodeAt(i);switch(t){case T:{s===I&&(t=ce);break}case ce:{s===Q?t=ye:s===g?t=ue:j(s)?(f=i,u=void 0,t=Y,--i):s===We?(t=F,--i):(t=T,--i);break}case ue:{j(s)?(t=Y,--i):s===h?t=T:(t=F,--i);break}case Y:{C(s)?(t=k,u=H(a,f,i)):s===g?t=x:s===h&&(u=H(a,f,i),t=B(u)?b:T);break}case k:{C(s)||(s===g||s===h?(t=J,--i):s===V?(t=P,p=i+1,c=void 0):(t=P,--i,p=i+1,c=void 0));break}case P:{C(s)||s===g||s===h?(t=J,--i,c=i):s===V&&(t=G,c=i);break}case J:{C(s)||(s===g?t=x:s===V?t=G:s===h?t=B(u)?b:T:(t=P,--i,p=i+1,c=void 0));break}case G:{C(s)||(s===ae?t=Z:s===le?t=z:s===h?t=B(u)?b:T:(t=q,--i));break}case Z:{s===ae&&(t=K);break}case z:{s===le&&(t=K);break}case q:{C(s)?t=k:s===h&&(t=B(u)?b:T);break}case K:{C(s)?t=k:s===g?t=x:s===h?t=B(u)?b:T:(t=k,--i);break}case x:{s===h?t=T:(t=k,--i);break}case F:{s===h&&(t=T);break}case de:{s===_?t=fe:s===h?t=T:(t=w,--i);break}case fe:{s===_?t=U:s===h?t=T:(t=w,--i);break}case w:{s===I?t=pe:s===_&&(t=ee);break}case pe:{s===Q?t=Ee:s!==I&&(t=w,--i);break}case Ee:{s===_?t=Te:(t=w,--i);break}case Te:{s===_?t=he:(t=U,--i);break}case he:{t=U,--i;break}case ee:{s===_?t=U:(t=w,--i);break}case U:{s===h?t=T:s===Q?t=me:s!==_&&(t=w,--i);break}case me:{s===_?t=ee:s===h?t=T:(t=w,--i);break}case ye:{s===_&&a.charCodeAt(i+1)===_?(t=de,++i):(t=F,--i);break}case b:{s===I&&(t=_e);break}case _e:{s===g?t=be:(t=b,--i);break}case be:{j(s)?(f=i,t=Se,--i):(t=b,--i);break}case Se:{C(s)&&u===H(a,f,i)?t=k:s===g&&u===H(a,f,i)?t=x:s===h&&u===H(a,f,i)?t=T:j(s)||(t=b,--i);break}default:{t=void 0;break}}}l+=a}let y=e(l),L=document.createTreeWalker(y,E,null,!1),N=[];for(;L.nextNode();){let o=L.currentNode;switch(o.nodeType){case Ye:{let S=o.attributes;for(let a=0,i=S.length;a<i;++a){let{name:d,value:s}=S[a];if(/^::/.test(d)){let O=arguments[+d.slice(2)];ke(o,d),--a,--i;for(let $ in O){let A=O[$];A==null||A===!1||(typeof A=="function"?o[$]=A:$==="style"&&te(A)?Ce(o[$],A):Je(o,$,A===!0?"":A))}}else if(/^::/.test(s)){let O=arguments[+s.slice(2)];ke(o,d),--a,--i,typeof O=="function"?o[d]=O:Ce(o[d],O)}}break}case Ve:{if(/^::/.test(o.data)){let S=o.parentNode,a=arguments[+o.data.slice(2)];if(a instanceof Node)S.insertBefore(a,o);else if(typeof a!="string"&&a[Symbol.iterator])if(a instanceof NodeList||a instanceof HTMLCollection)for(let i=a.length-1,d=o;i>=0;--i)d=S.insertBefore(a[i],d);else for(let i of a)i!=null&&S.insertBefore(i instanceof Node?i:document.createTextNode(i),o);else S.insertBefore(document.createTextNode(a),o);N.push(o)}break}}}for(let o of N)o.parentNode.removeChild(o);return n(y)}}function M(e){return`&#${e.charCodeAt(0).toString()};`}function j(e){return Ge<=e&&e<=qe||je<=e&&e<=Xe}function C(e){return e===Be||e===He||e===Ie||e===Pe||e===Fe}function te(e){return e&&e.toString===Object.prototype.toString}function B(e){return e==="script"||e==="style"||Re(e)}function Re(e){return e==="textarea"||e==="title"}function H(e,n,r){return e.slice(n,r).toLowerCase()}function Je(e,n,r){if(e.namespaceURI===Ne&&(n=n.toLowerCase(),n=ve.get(n)||n,X.has(n))){e.setAttributeNS(X.get(n),n,r);return}e.setAttribute(n,r)}function ke(e,n){if(e.namespaceURI===Ne&&(n=n.toLowerCase(),n=ve.get(n)||n,X.has(n))){e.removeAttributeNS(X.get(n),n);return}e.removeAttribute(n)}function Ce(e,n){for(let r in n){let t=n[r];r.startsWith("--")?e.setProperty(r,t):e[r]=t}}var Ze=document.querySelector("script#datasette-write-ui-config"),Le=JSON.parse(Ze.textContent),D=Le,R=Le.base_url;async function ne(e){let n=await e.json();if(e.status<200||e.status>299||!n.ok)throw Error(n.errors?n.errors.join(", "):"Unknown error");return n}async function Oe(e,n,r){return fetch(`${R}${e}/${n}/${r}/-/delete`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"}}).then(ne)}async function Me(e,n,r,t){return fetch(`${R}${e}/${n}/${r}/-/update`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then(ne)}async function De(e,n,r){return fetch(`${R}${e}/${n}/-/insert`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({row:r})}).then(ne)}async function $e(e,n,r){return fetch(`${R}-/datasette-write-ui/edit-row-details?${new URLSearchParams({db:e,table:n,primaryKeys:r})}`).then(t=>t.json())}async function xe(e,n){return fetch(`${R}-/datasette-write-ui/insert-row-details?${new URLSearchParams({db:e,table:n})}`).then(r=>r.json())}var ie=class{constructor(){this.root=m`<div class="modal">
      <div class="modal-content">
        <span class="close">&times;</span>
        <h2 class="modal-title"></h2>
        <div class="modal-body"></div>
      </div>
    </div>`,document.body.appendChild(this.root),this.body=this.root.querySelector(".modal-body"),this.title=this.root.querySelector(".modal-title"),this.hide=this.hide.bind(this),this.show=this.show.bind(this),this.setTitle=this.setTitle.bind(this),this.setBody=this.setBody.bind(this),this.root.querySelector(".close").addEventListener("click",this.hide),document.addEventListener("keydown",n=>{n.key==="Escape"&&this.hide()})}hide(){return this.root.style.display="none",this}show(){return this.root.style.display="block",this}setTitle(n){return this.title.innerText=n,this}setBody(n){return this.body.innerHTML="",this.body.appendChild(n),this}},se=class{constructor(n){this.hide=this.hide.bind(this),this.show=this.show.bind(this),this.toggle=this.toggle.bind(this),this.addButton=this.addButton.bind(this),this.root=m`<span class="row-icon"><button class="icon">&#9881;</button><div class="datasette-write-ui-menu"></div></span>`,n.insertBefore(this.root,n.querySelector("a")),this.icon=this.root.querySelector(".icon"),this.menu=this.root.querySelector(".datasette-write-ui-menu"),this.icon.addEventListener("click",r=>{r.stopPropagation(),this.toggle()}),document.addEventListener("click",this.hide),document.addEventListener("keydown",r=>{r.key==="Escape"&&this.hide()}),this.menu.addEventListener("click",r=>{r.stopPropagation()})}hide(){this.menu.style.display="none",this.menu.isShown=!1}show(){Array.from(document.querySelectorAll(".datasette-write-ui-menu")).forEach(r=>{r.style.display="none",r.isShown=!1});let n=document.body;this.menu.style.display="block",this.menu.isShown=!0,ze(this.menu,n)}toggle(){this.menu.isShown?this.hide():this.show()}addButton(n,r){return this.menu.appendChild(m`<button onClick=${r}>${n}</button>`),this}};function ze(e,n){let r=e.getBoundingClientRect(),t=n.getBoundingClientRect(),l=r.top-t.top,f=r.left-t.left;e.style.position="absolute",e.style.top=l+"px",e.style.left=f+"px",n.appendChild(e)}function Ke(e){return e.type==="int"||e.type==="float"||e.type==="INT"?m`<input
      type="number"
      value=${e.value}
      name=${e.key}
      id=${e.key}
      disabled=${!e.editable}
      step=${e.type==="int"?1:.01}
    />`:e.type==="str"||e.type=="TEXT"?m`<textarea
        name=${e.key}
        id=${e.key}
        disabled=${!e.editable}>${e.value}`:m`<p>Unsupported type ${e.type} for ${e.key}</p>`}function et(e){return e.affinity==="int"||e.affinity==="real"||e.affinity==="numeric"?m`<input
      type="number"
      name=${e.name}
      id=${e.name}
      step=${e.affinity==="int"?1:.01}
    />`:e.affinity=="text"?m`<textarea
        name=${e.name}
        id=${e.name}>`:m`<p>Unsupported type ${e.affinity} for ${e.name}</p>`}function tt(e,n,r){return async function(){let l=await $e(e,n,r),f=new Map;function u(c){c.preventDefault();let E={};for(let[L,N]of f.entries()){if(N.disabled)continue;let o=N.type==="number"?N.valueAsNumber:N.value;E[L]=o}Me(e,n,r,{update:E,return:!0}).then(()=>window.location.reload())}let p=m` <form onSubmit=${u}>
      <div>
        <div class="form-fields-container">
          ${l.fields.map(c=>{let E=Ke(c);return f.set(c.key,E),m.fragment`
                <div> <label for=${c.key}>${c.key}</label> ${c.pk?"\u{1F511}":""} </div>
                <div> ${E} </div>
                `})}
        </div>
      </div>
      <input type="submit" value="Submit" />
    </form>`;Ue.setBody(p).setTitle(`Editing ${e}/${n}/${r}`).show()}}function nt(e,n){return async function(){let{fields:t}=await xe(e,n),l=new Map;function f(p){p.preventDefault();let c={};for(let[E,y]of l.entries()){if(y.disabled)continue;let L=y.type==="number"?y.valueAsNumber:y.value;c[E]=L}De(e,n,c).then(()=>window.location.reload())}let u=m` <form onSubmit=${f}>
      <div>
        <div class="form-fields-container">
          ${t.map(p=>{let c=et(p);return l.set(p.name,c),m.fragment`
                <div> <label for=${p.name}>${p.name}</label></div>
                <div> ${c} </div>
                `})}
        </div>
      </div>
      <input type="submit" value="Submit" />
    </form>`;Ue.setBody(u).setTitle(`Inserting into ${e}/${n}`).show()}}function it(e,n,r){return function(){window.confirm(`Are you sure you want to delete ${e}/${n}/${r}?`)&&Oe(e,n,r).then(()=>window.location.reload())}}var Ue=new ie;if(D.can_update||D.can_delete){let e=Array.from(document.querySelectorAll("table.rows-and-columns tbody tr"));for(let n of e){let r=n.querySelector("td.type-pk"),t=Array.from(n.querySelectorAll("td:not(.type-pk)")),l=r.querySelector("a").getAttribute("href"),[f,u,p]=l.split("/").slice(-3),c=new se(r);if(D.can_update){let E=tt(f,u,p);c.addButton("Edit",E),n.addEventListener("click",y=>{y.shiftKey&&E()});for(let y of t);}if(D.can_delete){let E=it(f,u,p);c.addButton("Delete",E)}}}D.can_insert&&document.querySelector("#datasette-write-ui-insert-button").addEventListener("click",async()=>{let[n,r]=window.location.pathname.split("/").slice(-2);nt(n,r)()});
